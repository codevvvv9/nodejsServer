<title>首页</title>
<link rel="stylesheet" href="/style.css">
<h5>您的账户余额是<span id="amount">&&&amount&&&</span></h5>
<button id="button">付款1块钱</button>
<!-- <form action="/pay" method="post" target="result">
  <input type="text" name="number" value="1">
  <input type="submit" value="付款">
</form>

<iframe name="result" src="about:blank" frameborder="0"></iframe> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script >
 
  button.addEventListener('click', (e) => {
    // let n = amount.innerText
    // let number = parseInt(n, 10)
    // let newNumber = number - 1
    // amount.innerText = newNumber

    //用图片发起get请求
    // let image = document.createElement('img')
    // image.src = '/pay'
    // image.onload = function() {
    //   alert('打钱成功')
    //   amount.innerText = amount.innerText - 1
    // }
    // image.onerror = function() {
    //   alert('打钱失败')
    // }
    
    //用js脚本发起请求  
    // let script = document.createElement('script')
    // let functionName = 'wushao' + parseInt((Math.random()*100000), 10)
    // window[functionName] = function (result) {
    //   if (result === 'success') {
    //     amount.innerText = amount.innerText - 1
    //   } else {

    //   }
    // }
    // script.src = 'http://jack.com:8001/pay?callback=' + functionName
    // document.body.appendChild(script)
    // script.onload = function(e) {
    //   //debugger//可以使用它看到效果
    //   e.currentTarget.remove()
    //   delete window[functionName]
    // }
    // script.onerror = function(e) {
    //   alert('failed')
    //   e.currentTarget.remove()
    //   delete window[functionName]
    // }
    $.ajax({
      url: "http://jack.com:8001/pay",

      // The name of the callback parameter, as specified by the YQL service
      jsonp: "callback",

      // Tell jQuery we're expecting JSONP
      dataType: "jsonp",

      // Work with the response
      success: function (response) {
        if(response === 'success') {
          amount.innerText = amount.innerText - 1 
        }  
      }
    })
  })

  
</script>
<!-- <script src="/main.js?callback=xxx"></script> -->

